# Description: Thinstation essential package
# URL: http://www.thinstation.org
# Maintainer: Donald A. Cupp Jr. (don cupp jr at ya hoo dot com)

name=cryptodev-linux
version=git
release=1
kernel=`cat /ts/ports/kernel-modules/VERSION`
source=()

build() {
	git clone https://github.com/moonman/cryptodev-linux.git
#wget	https://raw.githubusercontent.com/moonman/cryptodev-linux/cdbe7ee5978704c788e91170467fe0db064650fe/zc.c

	cd $name
#	cp ../zc.c .

	REPORT_KERNEL=`cat /boot/KERNEL_VERSION`
	export REPORT_KERNEL

	make -j1
	install -m 644 -D crypto/cryptodev.h $PKG/usr/include/crypto/cryptodev.h
	install -m 644 -D cryptodev.ko $PKG/lib/modules/`uname -r`/kernel/extra/cryptodev.ko

	/usr/src/kernels/$REPORT_KERNEL/scripts/sign-file \
	sha256 /etc/ssl/keys/kernel.key \
	/etc/ssl/certs/kernel.crt \
        $PKG/lib/modules/$REPORT_KERNEL/kernel/extra/cryptodev.ko
}
