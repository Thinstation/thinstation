# Description:
# URL:
# Packager:
# Maintainer:

name=rtl8723bs
version=git
release=1
kver=`cat /ts/ports/kernel-modules/VERSION`
source=()

# Note: This driver is upstream as of 4.12, so we can remove this then
# This is checked out to the last version before the contents were removed
# Indication is that no futher updates will be made
build() {
    git clone https://github.com/hadess/rtl8723bs.git $name
    cd $name
    git checkout db2c4f6
    sed -e 's|/lib/modules/$(KVER)/kernel|$(PKG)/lib/modules/$(KVER)/kernel|g' -i Makefile
    sed -e 's|/lib/firmware|$(PKG)/lib/firmware|g' -i Makefile
    sed -e 's|^install:|install:\n\tmkdir -p $(MODDESTDIR)\n\tmkdir -p $(PKG)/lib/firmware/rtlwifi|g' -i Makefile
    sed -e '/depmod/d' -i Makefile


    for KERNELTYPE in TS
    do
       export REPORT_KERNEL=${kver}$KERNELTYPE

       make
       make install DEST=$PKG
       make clean
    done

    # Firmware is in upstream kernel firmware
    rm -rf $PKG/lib/firmware
}

